<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Налаштування системи - Пекарня в Ходосівці</title>
    <link rel="stylesheet" href="auth-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <img src="logo.jpg" alt="Пекарня в Ходосівці">
                <h1>Налаштування системи</h1>
                <p>Створення першого адміністратора</p>
            </div>

            <div id="setup-content">
                <div class="status-item">
                    <i class="fas fa-spinner fa-spin"></i>
                    Перевіряємо систему...
                </div>
            </div>

            <div class="back-link">
                <a href="index.html">
                    <i class="fas fa-home"></i> Головна сторінка
                </a>
            </div>
        </div>
    </div>

    <script>
        function checkSetup() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const admins = JSON.parse(localStorage.getItem('admins') || '[]');
            
            let html = '<div style="text-align: left;">';
            
            if (admins.length === 0) {
                // No admins - show setup form
                html += `
                    <div class="status-item">
                        <i class="fas fa-exclamation-triangle"></i>
                        <strong>Адміністраторів не знайдено</strong>
                    </div>
                    
                    <form id="setup-form" style="margin-top: 20px;">
                        <div class="form-group">
                            <label for="admin-name">Ім'я адміністратора</label>
                            <input type="text" id="admin-name" class="form-input" placeholder="Ваше ім'я" required>
                        </div>
                        <div class="form-group">
                            <label for="admin-phone">Телефон</label>
                            <input type="tel" id="admin-phone" class="form-input" value="+380688834630" readonly>
                        </div>
                        <div class="form-group">
                            <label for="admin-password">Пароль</label>
                            <div class="password-container">
                                <input type="password" id="admin-password" class="form-input" placeholder="Мінімум 6 символів" required>
                                <button type="button" class="password-toggle" onclick="togglePassword('admin-password')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="admin-confirm">Підтвердіть пароль</label>
                            <div class="password-container">
                                <input type="password" id="admin-confirm" class="form-input" placeholder="Повторіть пароль" required>
                                <button type="button" class="password-toggle" onclick="togglePassword('admin-confirm')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-user-shield"></i> Створити головного адміністратора
                        </button>
                    </form>
                `;
            } else {
                // Admins exist - show status
                html += `
                    <div class="status-item">
                        <i class="fas fa-check-circle"></i>
                        <strong>Система налаштована</strong>
                    </div>
                    <div class="status-item">
                        <i class="fas fa-user-shield"></i>
                        <strong>Адміністраторів:</strong> ${admins.length}
                    </div>
                    <div style="margin-top: 20px;">
                        <a href="admin-login.html" class="btn btn-primary" style="display: block; text-align: center;">
                            <i class="fas fa-sign-in-alt"></i> Увійти в адмін панель
                        </a>
                    </div>
                `;
            }
            
            html += '</div>';
            document.getElementById('setup-content').innerHTML = html;
            
            // Add form handler if form exists
            const form = document.getElementById('setup-form');
            if (form) {
                form.addEventListener('submit', handleSetup);
            }
        }
        
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const toggleBtn = input.parentNode.querySelector('.password-toggle i');
            
            if (input.type === 'password') {
                input.type = 'text';
                toggleBtn.className = 'fas fa-eye-slash';
            } else {
                input.type = 'password';
                toggleBtn.className = 'fas fa-eye';
            }
        }
        
        function handleSetup(e) {
            e.preventDefault();
            
            const name = document.getElementById('admin-name').value;
            const phone = document.getElementById('admin-phone').value;
            const password = document.getElementById('admin-password').value;
            const confirm = document.getElementById('admin-confirm').value;
            
            if (password.length < 6) {
                alert('Пароль повинен містити мінімум 6 символів');
                return;
            }
            
            if (password !== confirm) {
                alert('Паролі не співпадають');
                return;
            }
            
            // Create admin user
            const newUser = {
                id: Date.now(),
                name,
                phone,
                password,
                createdAt: new Date().toISOString()
            };
            
            // Add to users list
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            // Add to admins list
            const admins = JSON.parse(localStorage.getItem('admins') || '[]');
            const newAdmin = {
                phone: phone,
                level: 'admin',
                addedAt: new Date().toISOString()
            };
            admins.push(newAdmin);
            localStorage.setItem('admins', JSON.stringify(admins));
            
            // Set as current user
            localStorage.setItem('currentUser', JSON.stringify(newUser));
            localStorage.setItem('adminLoggedIn', 'true');
            localStorage.setItem('adminLoginTime', Date.now());
            
            alert('Головного адміністратора створено! Перенаправлення...');
            
            setTimeout(() => {
                window.location.href = 'admin.html';
            }, 1000);
        }

        // Check setup on page load
        window.addEventListener('load', checkSetup);
    </script>

    <style>
        .status-item {
            margin: 10px 0;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-item i {
            width: 20px;
            color: #8B7355;
        }
    </style>
</body>
</html> 