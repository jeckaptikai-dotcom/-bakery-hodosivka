<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å - –ü–µ–∫–∞—Ä–Ω—è –≤ –•–æ–¥–æ—Å—ñ–≤—Ü—ñ</title>
    <link rel="stylesheet" href="admin-styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="admin-container">
        <!-- Header -->
        <header class="admin-header">
            <div class="header-content">
                                    <div class="logo">
                        <img src="logo.jpg" alt="–ü–µ–∫–∞—Ä–Ω—è" class="logo-img">
                        <h1>–ê–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å</h1>
                        <p style="font-size: 0.9rem; color: #8B7355; margin: 0;">–¢–≤–æ—Ä–µ—Ü—å: @mm.slmn</p>
                        <p id="user-level" style="font-size: 0.8rem; color: #4D372C; margin: 0; font-weight: 500;"></p>
                    </div>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="previewSite()">
                        <i class="fas fa-eye"></i> –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å–∞–π—Ç
                    </button>
                    <button class="btn btn-primary" onclick="saveChanges()">
                        <i class="fas fa-save"></i> –ó–±–µ—Ä–µ–≥—Ç–∏
                    </button>
                    <button class="btn btn-secondary" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> –í–∏–π—Ç–∏
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="admin-main">
            <!-- Navigation Tabs -->
            <div class="tabs">
                <button class="tab-btn active" data-tab="content">
                    <i class="fas fa-edit"></i> –ö–æ–Ω—Ç–µ–Ω—Ç
                </button>
                <button class="tab-btn" data-tab="menu">
                    <i class="fas fa-utensils"></i> –ú–µ–Ω—é
                </button>
                <button class="tab-btn" data-tab="contact">
                    <i class="fas fa-phone"></i> –ö–æ–Ω—Ç–∞–∫—Ç–∏
                </button>
                <button class="tab-btn" data-tab="settings">
                    <i class="fas fa-cog"></i> –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
                </button>
                <button class="tab-btn" data-tab="admins">
                    <i class="fas fa-users-cog"></i> –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∏
                </button>
            </div>

            <!-- Content Tab -->
            <div class="tab-content active" id="content">
                <div class="section">
                    <h3>–ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞</h3>
                    <div class="form-group">
                        <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                        <input type="text" id="hero-title" value="–°–≤—ñ–∂–∞ –≤–∏–ø—ñ—á–∫–∞ —â–æ–¥–Ω—è" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>–ü—ñ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
                        <textarea id="hero-subtitle" class="form-textarea">–ù–∞—Ç—É—Ä–∞–ª—å–Ω—ñ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ —Ç–∞ —Ç—Ä–∞–¥–∏—Ü—ñ–π–Ω—ñ —Ä–µ—Ü–µ–ø—Ç–∏ –¥–ª—è –Ω–∞–π–∫—Ä–∞—â–æ–≥–æ —Å–º–∞–∫—É</textarea>
                    </div>
                </div>

                <div class="section">
                    <h3>–ü—Ä–æ –Ω–∞—Å</h3>
                    <div class="form-group">
                        <label>–û–ø–∏—Å</label>
                        <textarea id="about-text" class="form-textarea">–ù–∞—à–∞ –ø–µ–∫–∞—Ä–Ω—è –≤ –•–æ–¥–æ—Å—ñ–≤—Ü—ñ - —Ü–µ –º—ñ—Å—Ü–µ, –¥–µ —Ç—Ä–∞–¥–∏—Ü—ñ—ó –∑—É—Å—Ç—Ä—ñ—á–∞—é—Ç—å—Å—è –∑ —è–∫—ñ—Å—Ç—é. –ú–∏ –≤–∏–ø—ñ–∫–∞—î–º–æ —Å–≤—ñ–∂–∏–π —Ö–ª—ñ–± —Ç–∞ –∫–æ–Ω–¥–∏—Ç–µ—Ä—Å—å–∫—ñ –≤–∏—Ä–æ–±–∏ —â–æ–¥–Ω—è, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ç—ñ–ª—å–∫–∏ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ñ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏.</textarea>
                    </div>
                </div>
            </div>

            <!-- Menu Tab -->
            <div class="tab-content" id="menu">
                <div class="section">
                    <h3>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏</h3>
                    <button class="btn btn-primary" onclick="addCategory()">
                        <i class="fas fa-plus"></i> –î–æ–¥–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é
                    </button>
                    
                    <div class="categories" id="categories">
                        <!-- Categories will be loaded here -->
                    </div>
                </div>
                
                <div class="section">
                    <h3>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏</h3>
                    <button class="btn btn-primary" onclick="addMenuItem()">
                        <i class="fas fa-plus"></i> –î–æ–¥–∞—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç
                    </button>
                    
                    <div class="menu-items" id="menu-items">
                        <!-- Menu items will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Contact Tab -->
            <div class="tab-content" id="contact">
                <div class="section">
                    <h3>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h3>
                    <div class="form-group">
                        <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="tel" id="phone" value="+380976492525" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>–ê–¥—Ä–µ—Å–∞</label>
                        <input type="text" id="address" value="–≤—É–ª. –§–µ–æ–¥–æ—Å—ñ—è –ü–µ—á–µ—Ä—Å—å–∫–æ–≥–æ, 1, –•–æ–¥–æ—Å—ñ–≤–∫–∞, –ö–∏—ó–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å, 08173" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>–ì–æ–¥–∏–Ω–∏ —Ä–æ–±–æ—Ç–∏</label>
                        <input type="text" id="hours" value="–©–æ–¥–Ω—è –∑ 08:00 –¥–æ 21:00" class="form-input">
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-content" id="settings">
                <div class="section">
                    <h3>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–∞–π—Ç—É</h3>
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞ —Å–∞–π—Ç—É</label>
                        <input type="text" id="site-title" value="–ü–µ–∫–∞—Ä–Ω—è –≤ –•–æ–¥–æ—Å—ñ–≤—Ü—ñ" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>–ö–æ–ª—ñ—Ä —Ç–µ–º–∏</label>
                        <select id="theme-color" class="form-select">
                            <option value="brown">–ö–æ—Ä–∏—á–Ω–µ–≤–∏–π</option>
                            <option value="beige">–ë–µ–∂–µ–≤–∏–π</option>
                            <option value="cream">–ö—Ä–µ–º–æ–≤–∏–π</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Admins Tab -->
            <div class="tab-content" id="admins">
                <div class="section">
                    <h3>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏</h3>
                    <p>–¢—É—Ç –≤–∏ –º–æ–∂–µ—Ç–µ –¥–æ–¥–∞–≤–∞—Ç–∏ —Ç–∞ –≤–∏–¥–∞–ª—è—Ç–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤ —Å–∞–π—Ç—É.</p>
                    <button class="btn btn-primary" onclick="window.location.href='admin-users.html'">
                        <i class="fas fa-users-cog"></i> –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal for adding categories -->
    <div class="modal" id="category-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–î–æ–¥–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</h3>
                <button class="close-btn" onclick="closeCategoryModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</label>
                    <input type="text" id="category-name" class="form-input" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –•–ª—ñ–±">
                </div>
                <div class="form-group">
                    <label>–û–ø–∏—Å –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</label>
                    <textarea id="category-description" class="form-textarea" placeholder="–ö–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó"></textarea>
                </div>
                <div class="form-group">
                    <label>–ö–æ–¥ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</label>
                    <input type="text" id="category-code" class="form-input" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: bread">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeCategoryModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                <button class="btn btn-primary" onclick="saveCategory()">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
            </div>
        </div>
    </div>

    <!-- Modal for adding menu items -->
    <div class="modal" id="menu-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–î–æ–¥–∞—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞ –ø—Ä–æ–¥—É–∫—Ç—É</label>
                    <input type="text" id="item-name" class="form-input">
                </div>
                <div class="form-group">
                    <label>–û–ø–∏—Å</label>
                    <textarea id="item-description" class="form-textarea"></textarea>
                </div>
                <div class="form-group">
                    <label>–¶—ñ–Ω–∞ (–≥—Ä–Ω)</label>
                    <input type="number" id="item-price" class="form-input">
                </div>
                <div class="form-group">
                    <label>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
                    <select id="item-category" class="form-select">
                        <option value="">–í–∏–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</option>
                        <!-- Categories will be loaded here -->
                    </select>
                </div>
                <div class="form-group">
                    <label>–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç—É</label>
                    <div class="image-upload-container">
                        <input type="file" id="item-image-file" class="form-input" accept="image/*" onchange="previewImage(this)">
                        <div class="image-preview" id="image-preview">
                            <p>–ü–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å —Ñ–æ—Ç–æ —Å—é–¥–∏ –∞–±–æ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è –≤–∏–±–æ—Ä—É</p>
                        </div>
                        <div class="image-options">
                            <label>
                                <input type="radio" name="image-source" value="url" checked onchange="toggleImageSource()"> URL –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è)
                            </label>
                            <label>
                                <input type="radio" name="image-source" value="file" onchange="toggleImageSource()"> –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑ –ø—Ä–∏—Å—Ç—Ä–æ—é
                            </label>
                        </div>
                        <input type="text" id="item-image-url" class="form-input" placeholder="https://images.unsplash.com/photo-1509440159596-0249088772ff?w=400&h=300&fit=crop">
                        <p style="font-size: 12px; color: #666; margin-top: 5px;">
                            üí° –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –∑ <a href="https://unsplash.com/s/photos/bread" target="_blank">Unsplash</a>, 
                            <a href="https://www.pexels.com/search/bread/" target="_blank">Pexels</a> –∞–±–æ 
                            <a href="https://imgur.com/" target="_blank">Imgur</a>
                        </p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                <button class="btn btn-primary" onclick="saveMenuItem()">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
            </div>
        </div>
    </div>

    <script src="admin.js"></script>
    <script>
                // Check authentication
        function checkAuth() {
            const isLoggedIn = localStorage.getItem('adminLoggedIn');
            const loginTime = localStorage.getItem('adminLoginTime');
            const currentTime = Date.now();

            // Check if logged in and session is valid (24 hours)
            if (!isLoggedIn || !loginTime || (currentTime - loginTime) > 24 * 60 * 60 * 1000) {
                // Clear invalid session
                localStorage.removeItem('adminLoggedIn');
                localStorage.removeItem('adminLoginTime');

                // Check if we're on init page
                if (window.location.pathname.includes('init-admin.html')) {
                    return true; // Allow access to init page
                }

                // Redirect to login
                window.location.href = 'admin-login.html';
                return false;
            }
            return true;
        }
        
        // Check auth on page load
        window.addEventListener('load', function() {
            if (!checkAuth()) {
                return;
            }
        });
        
        // Add logout function
        function logout() {
            localStorage.removeItem('adminLoggedIn');
            localStorage.removeItem('adminLoginTime');
            window.location.href = 'admin-login.html';
        }
        
        // Check admin permissions
        function checkAdminPermissions() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser) {
                window.location.href = 'admin-login.html';
                return;
            }
            
            const admins = JSON.parse(localStorage.getItem('admins') || '[]');
            const userAdmin = admins.find(a => a.phone === currentUser.phone);
            
            if (!userAdmin) {
                // If no admins exist, allow access to create first admin
                if (admins.length === 0) {
                    return;
                }
                
                alert('–£ –≤–∞—Å –Ω–µ–º–∞—î –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É –¥–æ –∞–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—ñ');
                window.location.href = 'index.html';
                return;
            }
            
            // Hide admin management for moderators
            if (userAdmin.level === 'moderator') {
                const adminsTab = document.querySelector('[data-tab="admins"]');
                if (adminsTab) {
                    adminsTab.style.display = 'none';
                }
            }
        }
        
        // Display user level
        function displayUserLevel() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const userLevelElement = document.getElementById('user-level');
            
            if (currentUser && userLevelElement) {
                const admins = JSON.parse(localStorage.getItem('admins') || '[]');
                const userAdmin = admins.find(a => a.phone === currentUser.phone);
                
                if (userAdmin) {
                    let levelText = '';
                    let levelColor = '';
                    
                    switch(userAdmin.level) {
                        case 'owner':
                            levelText = 'üëë –í–ª–∞—Å–Ω–∏–∫';
                            levelColor = '#FFD700';
                            break;
                        case 'admin':
                            levelText = '‚öôÔ∏è –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä';
                            levelColor = '#4CAF50';
                            break;
                        case 'moderator':
                            levelText = 'üîß –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä';
                            levelColor = '#2196F3';
                            break;
                        default:
                            levelText = 'üë§ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á';
                            levelColor = '#9E9E9E';
                    }
                    
                    userLevelElement.textContent = `${currentUser.name} - ${levelText}`;
                    userLevelElement.style.color = levelColor;
                } else {
                    userLevelElement.textContent = `${currentUser.name} - üë§ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á`;
                    userLevelElement.style.color = '#9E9E9E';
                }
            }
        }
        
        // Category management functions
        function addCategory() {
            document.getElementById('category-modal').style.display = 'block';
        }
        
        function closeCategoryModal() {
            document.getElementById('category-modal').style.display = 'none';
            // Clear form
            document.getElementById('category-name').value = '';
            document.getElementById('category-description').value = '';
            document.getElementById('category-code').value = '';
        }
        
        function saveCategory() {
            const name = document.getElementById('category-name').value;
            const description = document.getElementById('category-description').value;
            const code = document.getElementById('category-code').value;
            
            if (!name || !code) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –Ω–∞–∑–≤—É —Ç–∞ –∫–æ–¥ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó');
                return;
            }
            
            const category = {
                id: Date.now(),
                name: name,
                description: description,
                code: code,
                createdAt: new Date().toISOString()
            };
            
            // Get existing categories
            const categories = JSON.parse(localStorage.getItem('categories') || '[]');
            categories.push(category);
            localStorage.setItem('categories', JSON.stringify(categories));
            
            closeCategoryModal();
            loadCategories();
            alert('–ö–∞—Ç–µ–≥–æ—Ä—ñ—é –¥–æ–¥–∞–Ω–æ!');
        }
        
        function loadCategories() {
            const categories = JSON.parse(localStorage.getItem('categories') || '[]');
            const container = document.getElementById('categories');
            
            if (categories.length === 0) {
                container.innerHTML = '<p>–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –∫–∞—Ç–µ–≥–æ—Ä—ñ–π</p>';
            } else {
                container.innerHTML = categories.map((category, index) => `
                    <div class="menu-item">
                        <div class="menu-item-header">
                            <div class="menu-item-title">
                                <i class="fas fa-tag"></i>
                                ${category.name}
                                <span class="category-code">(${category.code})</span>
                            </div>
                            <div class="menu-item-actions">
                                <button class="btn btn-secondary" onclick="editCategory(${index})">
                                    <i class="fas fa-edit"></i> –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
                                </button>
                                <button class="btn btn-secondary" onclick="deleteCategory(${index})">
                                    <i class="fas fa-trash"></i> –í–∏–¥–∞–ª–∏—Ç–∏
                                </button>
                            </div>
                        </div>
                        <div class="menu-item-details">
                            ${category.description || '–ù–µ–º–∞—î –æ–ø–∏—Å—É'}
                        </div>
                    </div>
                `).join('');
            }
            
            // Also update the category select in menu modal
            loadCategorySelect();
        }
        
        function loadCategorySelect() {
            const categories = JSON.parse(localStorage.getItem('categories') || '[]');
            const select = document.getElementById('item-category');
            
            if (select) {
                let options = '<option value="">–í–∏–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</option>';
                categories.forEach(category => {
                    options += `<option value="${category.code}">${category.name}</option>`;
                });
                select.innerHTML = options;
            }
        }
        
        function deleteCategory(index) {
            if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü—é –∫–∞—Ç–µ–≥–æ—Ä—ñ—é?')) {
                const categories = JSON.parse(localStorage.getItem('categories') || '[]');
                categories.splice(index, 1);
                localStorage.setItem('categories', JSON.stringify(categories));
                loadCategories();
                alert('–ö–∞—Ç–µ–≥–æ—Ä—ñ—é –≤–∏–¥–∞–ª–µ–Ω–æ!');
            }
        }
        
        function editCategory(index) {
            const categories = JSON.parse(localStorage.getItem('categories') || '[]');
            const category = categories[index];
            
            document.getElementById('category-name').value = category.name;
            document.getElementById('category-description').value = category.description || '';
            document.getElementById('category-code').value = category.code;
            
            // Change modal title and button
            document.querySelector('#category-modal .modal-header h3').textContent = '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é';
            document.querySelector('#category-modal .modal-footer .btn-primary').onclick = function() {
                updateCategory(index);
            };
            
            document.getElementById('category-modal').style.display = 'block';
        }
        
        function updateCategory(index) {
            const name = document.getElementById('category-name').value;
            const description = document.getElementById('category-description').value;
            const code = document.getElementById('category-code').value;
            
            if (!name || !code) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –Ω–∞–∑–≤—É —Ç–∞ –∫–æ–¥ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó');
                return;
            }
            
            const categories = JSON.parse(localStorage.getItem('categories') || '[]');
            categories[index] = {
                ...categories[index],
                name: name,
                description: description,
                code: code,
                updatedAt: new Date().toISOString()
            };
            
            localStorage.setItem('categories', JSON.stringify(categories));
            closeCategoryModal();
            loadCategories();
            alert('–ö–∞—Ç–µ–≥–æ—Ä—ñ—é –æ–Ω–æ–≤–ª–µ–Ω–æ!');
        }
        
        // Menu items management functions
        function addMenuItem() {
            document.getElementById('menu-modal').style.display = 'block';
            // Reset form
            document.getElementById('item-name').value = '';
            document.getElementById('item-description').value = '';
            document.getElementById('item-price').value = '';
            document.getElementById('item-category').value = '';
            document.getElementById('item-image').value = '';
            
            // Change modal title and button
            document.querySelector('#menu-modal .modal-header h3').textContent = '–î–æ–¥–∞—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç';
            document.querySelector('#menu-modal .modal-footer .btn-primary').onclick = function() {
                saveMenuItem();
            };
        }
        
        function closeModal() {
            const modal = document.getElementById('menu-modal');
            if (modal) {
                modal.style.display = 'none';
                console.log('Modal closed');
            } else {
                console.error('Modal not found');
            }
        }
        
        function saveMenuItem() {
            console.log('saveMenuItem called');
            
            const name = document.getElementById('item-name').value;
            const description = document.getElementById('item-description').value;
            const price = document.getElementById('item-price').value;
            const category = document.getElementById('item-category').value;
            
            // Get image from URL field or use default
            const imageUrl = document.getElementById('item-image-url').value;
            const imageFile = document.getElementById('item-image-file').files[0];
            
            console.log('Form values:', { name, description, price, category, imageUrl, imageFile });
            
            if (!name || !price || !category) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –Ω–∞–∑–≤—É, —Ü—ñ–Ω—É —Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –ø—Ä–æ–¥—É–∫—Ç—É');
                return;
            }
            
            // Determine image source
            let image = 'https://images.unsplash.com/photo-1509440159596-0249088772ff?w=400&h=300&fit=crop'; // Default bread image
            if (imageUrl && imageUrl.trim()) {
                image = imageUrl.trim();
            } else if (imageFile) {
                // Convert file to base64 (not recommended for large files)
                const reader = new FileReader();
                reader.onload = function(e) {
                    const base64Image = e.target.result;
                    const menuItem = {
                        id: Date.now(),
                        name: name,
                        description: description,
                        price: price + ' –≥—Ä–Ω',
                        category: category,
                        image: base64Image,
                        createdAt: new Date().toISOString()
                    };
                    
                    const menuItems = JSON.parse(localStorage.getItem('menuItems') || '[]');
                    menuItems.push(menuItem);
                    localStorage.setItem('menuItems', JSON.stringify(menuItems));
                    
                    closeModal();
                    loadMenuItems();
                    alert('–ü—Ä–æ–¥—É–∫—Ç –¥–æ–¥–∞–Ω–æ! –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–æ —è–∫ Base64 (–º–æ–∂–µ –±—É—Ç–∏ –ø–æ–≤—ñ–ª—å–Ω–∏–º).');
                };
                reader.readAsDataURL(imageFile);
                return; // Exit early as we're handling the file asynchronously
            }
            
            const menuItem = {
                id: Date.now(),
                name: name,
                description: description,
                price: price + ' –≥—Ä–Ω',
                category: category,
                image: image,
                createdAt: new Date().toISOString()
            };
            
            console.log('Created menu item:', menuItem);
            
            // Get existing menu items
            const menuItems = JSON.parse(localStorage.getItem('menuItems') || '[]');
            menuItems.push(menuItem);
            
            console.log('All menu items:', menuItems);
            
            localStorage.setItem('menuItems', JSON.stringify(menuItems));
            
            console.log('Product saved to localStorage');
            
            closeModal();
            loadMenuItems();
            alert('–ü—Ä–æ–¥—É–∫—Ç –¥–æ–¥–∞–Ω–æ! –¢–µ–ø–µ—Ä –≤—ñ–Ω –∑\'—è–≤–∏—Ç—å—Å—è –Ω–∞ –≥–æ–ª–æ–≤–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ.');
        }
        
        function loadMenuItems() {
            console.log('loadMenuItems called');
            
            const menuItems = JSON.parse(localStorage.getItem('menuItems') || '[]');
            const container = document.getElementById('menu-items');
            
            console.log('Found menu items:', menuItems);
            console.log('Container:', container);
            
            if (!container) {
                console.error('Container menu-items not found!');
                return;
            }
            
            if (menuItems.length === 0) {
                container.innerHTML = '<p>–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –ø—Ä–æ–¥—É–∫—Ç—ñ–≤</p>';
                console.log('No products to display');
                return;
            }
            
            const html = menuItems.map((item, index) => `
                <div class="menu-item">
                    <div class="menu-item-header">
                        <div class="menu-item-title">
                            <i class="fas fa-utensils"></i>
                            ${item.name}
                            <span class="price">${item.price}</span>
                        </div>
                        <div class="menu-item-actions">
                            <button class="btn btn-secondary" onclick="editMenuItem(${index})">
                                <i class="fas fa-edit"></i> –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
                            </button>
                            <button class="btn btn-secondary" onclick="deleteMenuItem(${index})">
                                <i class="fas fa-trash"></i> –í–∏–¥–∞–ª–∏—Ç–∏
                            </button>
                        </div>
                    </div>
                    <div class="menu-item-details">
                        <p><strong>–û–ø–∏—Å:</strong> ${item.description || '–ù–µ–º–∞—î –æ–ø–∏—Å—É'}</p>
                        <p><strong>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</strong> ${item.category}</p>
                        <p><strong>–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è:</strong> ${item.image}</p>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
            console.log('Products loaded successfully');
        }
        
        function deleteMenuItem(index) {
            if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –ø—Ä–æ–¥—É–∫—Ç?')) {
                const menuItems = JSON.parse(localStorage.getItem('menuItems') || '[]');
                menuItems.splice(index, 1);
                localStorage.setItem('menuItems', JSON.stringify(menuItems));
                loadMenuItems();
                alert('–ü—Ä–æ–¥—É–∫—Ç –≤–∏–¥–∞–ª–µ–Ω–æ!');
            }
        }
        
        function editMenuItem(index) {
            const menuItems = JSON.parse(localStorage.getItem('menuItems') || '[]');
            const item = menuItems[index];
            
            document.getElementById('item-name').value = item.name;
            document.getElementById('item-description').value = item.description || '';
            document.getElementById('item-price').value = item.price.replace(' –≥—Ä–Ω', '');
            document.getElementById('item-category').value = item.category;
            document.getElementById('item-image-url').value = item.image;
            
            // Change modal title and button
            document.querySelector('#menu-modal .modal-header h3').textContent = '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç';
            document.querySelector('#menu-modal .modal-footer .btn-primary').onclick = function() {
                updateMenuItem(index);
            };
            
            document.getElementById('menu-modal').style.display = 'block';
        }
        
        function updateMenuItem(index) {
            const name = document.getElementById('item-name').value;
            const description = document.getElementById('item-description').value;
            const price = document.getElementById('item-price').value;
            const category = document.getElementById('item-category').value;
            
            // Get image from URL field or use default
            const imageUrl = document.getElementById('item-image-url').value;
            const imageFile = document.getElementById('item-image-file').files[0];
            
            if (!name || !price || !category) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –Ω–∞–∑–≤—É, —Ü—ñ–Ω—É —Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –ø—Ä–æ–¥—É–∫—Ç—É');
                return;
            }
            
            // Determine image source
            let image = 'default-food.jpg';
            if (imageUrl) {
                image = imageUrl;
            } else if (imageFile) {
                // For now, just use the filename
                image = imageFile.name;
            }
            
            const menuItems = JSON.parse(localStorage.getItem('menuItems') || '[]');
            menuItems[index] = {
                ...menuItems[index],
                name: name,
                description: description,
                price: price + ' –≥—Ä–Ω',
                category: category,
                image: image,
                updatedAt: new Date().toISOString()
            };
            
            localStorage.setItem('menuItems', JSON.stringify(menuItems));
            closeModal();
            loadMenuItems();
            alert('–ü—Ä–æ–¥—É–∫—Ç –æ–Ω–æ–≤–ª–µ–Ω–æ! –ó–º—ñ–Ω–∏ –∑\'—è–≤–ª—è—Ç—å—Å—è –Ω–∞ –≥–æ–ª–æ–≤–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ.');
        }
        
        // Image preview function
        function previewImage(input) {
            const file = input.files[0];
            const preview = document.getElementById('image-preview');
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" style="max-width: 200px; max-height: 200px;">`;
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Toggle image source
        function toggleImageSource() {
            const fileInput = document.getElementById('item-image-file');
            const urlInput = document.getElementById('item-image-url');
            const fileRadio = document.querySelector('input[name="image-source"][value="file"]');
            const urlRadio = document.querySelector('input[name="image-source"][value="url"]');
            
            if (urlRadio.checked) {
                fileInput.style.display = 'none';
                urlInput.style.display = 'block';
            } else {
                fileInput.style.display = 'block';
                urlInput.style.display = 'none';
            }
        }
        
        // Check permissions on page load
        window.addEventListener('load', function() {
            if (!checkAuth()) {
                return;
            }
            checkAdminPermissions();
            displayUserLevel();
            loadCategories(); // Load categories on page load
            loadMenuItems(); // Load menu items on page load
        });
    </script>
</body>
</html> 